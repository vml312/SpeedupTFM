<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Speedup: accelerate_srt Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Speedup
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespaceaccelerate__srt.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">accelerate_srt Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:afe8d4fc8530f7e9cf6b189fb4c048fc3"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceaccelerate__srt.html#afe8d4fc8530f7e9cf6b189fb4c048fc3">mp4_duration</a> (filename)</td></tr>
<tr class="memdesc:afe8d4fc8530f7e9cf6b189fb4c048fc3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Extracts the duration of the input video with ffmpeg.  <a href="namespaceaccelerate__srt.html#afe8d4fc8530f7e9cf6b189fb4c048fc3">More...</a><br /></td></tr>
<tr class="separator:afe8d4fc8530f7e9cf6b189fb4c048fc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7ccfa508b1ff21999b31eea447ca424"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceaccelerate__srt.html#ad7ccfa508b1ff21999b31eea447ca424">main</a> (input_path, srt_file, voice_else_srt, compr_acc_srt, new_name, speedup_video_name)</td></tr>
<tr class="memdesc:ad7ccfa508b1ff21999b31eea447ca424"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accelerates the original subtitle file.  <a href="namespaceaccelerate__srt.html#ad7ccfa508b1ff21999b31eea447ca424">More...</a><br /></td></tr>
<tr class="separator:ad7ccfa508b1ff21999b31eea447ca424"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Acceleration of the original subtitle file (accelerate_srt)

The actual operation of the file has the following srt files as input:
1. Use "compr_subs_acc.srt" to get all the trimmed video fragments.
2. Use "pelicula.srt" to have the text of each subtitle.
3. Use "voice-else_subs.srt" to have the text of each subtitle and differentiate between voice and else more easily than with "pelicula.srt".

The operation is as follows:
1. Calculation of reduction factor: Dividing the sum of MPEG-TS fragments duration by the whole video, when the concatenation is done this number is equal to 1, but when the 
adjustment is done to a time entered by keyboard this value is far from 1, because when this acceleration is done the subtitle times are not taken into account.

2. Creation of the base subtitle file to create the accelerated file: First the speech subtitles are inserted in ''voice_else.srt'' and then the non-speech subtitles in 
''compr_subs_acc.srt''. The reason is that in the first one the speech subtitles are not compressed, and in the second one there are more non-speech fragments because it has been 
analysed if they have different acceleration.

3. Obtaining a list of percentages of duration of each speech subtitle. To divide the speech subtitles in the file where the speech subtitles are compressed by 1 if they are separated
by less than 1 second, the percentage is found and then the accelerated time is found.

4. Time modification of the file created in step 3. The times are created by adding the durations of the MPEG-TS files, which are accelerated files, to each speech fragment 
corresponds the subtitles it had without acceleration in the original subtitle file. The expressions are the following:

duration_speedup = mp4_duration(f"{count+1}.ts")*1000*percentage_duration_list[ult_ind]/reduction_factor
accelerated_voice_else_subs[ult_ind].start = start
accelerated_voice_else_subs[ult_ind].end = start + duration_speedup

And therefore, when a speech fragment has more than one speech subtitle, the list of duration percentages will have a value other than 1 for that index, making it match the original with a minimum offset. The start 
and end times are therefore calculated as below.

6. Removal of non-speech subtitles. Speech and non-speech times have been accelerated above because the TS files are of both types, therefore only the speech ones are kept, to save 
the final product.
</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="ad7ccfa508b1ff21999b31eea447ca424"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7ccfa508b1ff21999b31eea447ca424">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def accelerate_srt.main </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>input_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>srt_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>voice_else_srt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>compr_acc_srt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>new_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>speedup_video_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accelerates the original subtitle file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">input_path</td><td>The path where the files are stored. </td></tr>
    <tr><td class="paramname">srt_file</td><td>The original subtitle file. </td></tr>
    <tr><td class="paramname">voice_else_srt</td><td>The subtitle file with the voice and else subtitles. </td></tr>
    <tr><td class="paramname">compr_acc_srt</td><td>The subtitle file with the compressed subtitles. </td></tr>
    <tr><td class="paramname">new_name</td><td>The name of the new subtitle file. </td></tr>
    <tr><td class="paramname">speedup_video_name</td><td>The name of the speedup video. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="accelerate__srt_8py_source.html#l00061">61</a> of file <a class="el" href="accelerate__srt_8py_source.html">accelerate_srt.py</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceaccelerate__srt_ad7ccfa508b1ff21999b31eea447ca424_cgraph.png" border="0" usemap="#namespaceaccelerate__srt_ad7ccfa508b1ff21999b31eea447ca424_cgraph" alt=""/></div>
<map name="namespaceaccelerate__srt_ad7ccfa508b1ff21999b31eea447ca424_cgraph" id="namespaceaccelerate__srt_ad7ccfa508b1ff21999b31eea447ca424_cgraph">
<area shape="rect" title="Accelerates the original subtitle file." alt="" coords="5,13,156,39"/>
<area shape="rect" href="namespaceaccelerate__srt.html#afe8d4fc8530f7e9cf6b189fb4c048fc3" title="Extracts the duration of the input video with ffmpeg." alt="" coords="204,5,351,47"/>
</map>
</div>

</div>
</div>
<a id="afe8d4fc8530f7e9cf6b189fb4c048fc3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe8d4fc8530f7e9cf6b189fb4c048fc3">&#9670;&nbsp;</a></span>mp4_duration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def accelerate_srt.mp4_duration </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>filename</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Extracts the duration of the input video with ffmpeg. </p>
<p>In other functions, duration is calculated with the number of frames and frame rate, but here it can<code>t be done like that because the input may be a mp4 with no video track (podcast).</code> </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filename</td><td>The input filename to determine exact duration. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The duration of the input video in seconds. </dd></dl>

<p class="definition">Definition at line <a class="el" href="accelerate__srt_8py_source.html#l00045">45</a> of file <a class="el" href="accelerate__srt_8py_source.html">accelerate_srt.py</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceaccelerate__srt.html">accelerate_srt</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
